<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Chess Pursuit - Mobile</title>
	<script type="text/javascript" src="src/game.js"></script>
	<style type="text/css">
		body{
			background-color: #000;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
			margin: 0;
			padding: 0;
			overflow: hidden;
			touch-action: none;
		}
		html,body,canvas{
			margin:0;
			padding: 0;
			height: 100%;
			width: 100%;
		}
		canvas,svg{
			display: block;
			position: absolute;
			top: 0;
			left: 0;
		}
		svg{
			overflow: hidden;
		}
		#root{
			cursor: pointer;
			position: relative;
			width: 100vw;
			height: 100vh;
			overflow: hidden;
		}
		.help{
			box-sizing: border-box;
			font-size: 12px;
			padding: 8px;
			color: #999;
			font-family: sans-serif;
			text-align:center;
			position: absolute;
			left:0;
			bottom: 0;
			width: 100%;
			z-index: 1000;
		}
		
		/* Mobile touch controls */
		.touch-controls {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 10px;
			z-index: 1000;
		}
		
		.touch-button {
			width: 50px;
			height: 50px;
			background: rgba(255, 255, 255, 0.2);
			border: 2px solid rgba(255, 255, 255, 0.5);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 20px;
			color: white;
			user-select: none;
			-webkit-user-select: none;
			touch-action: manipulation;
		}
		
		.touch-button:active {
			background: rgba(255, 255, 255, 0.4);
			transform: scale(0.95);
		}
		
		/* Hide touch controls on desktop */
		@media (min-width: 768px) {
			.touch-controls {
				display: none;
			}
		}
		
		/* Mobile-specific optimizations */
		@media (max-width: 767px) {
			.help {
				font-size: 10px;
				padding: 4px;
			}
			
			.touch-button {
				width: 45px;
				height: 45px;
				font-size: 18px;
			}
			
			.touch-controls {
				bottom: 10px;
				gap: 8px;
			}
		}
		
		/* Landscape orientation adjustments */
		@media (orientation: landscape) and (max-height: 500px) {
			.help {
				display: none;
			}
			
			.touch-controls {
				bottom: 5px;
			}
		}
	</style>
</head>
<body>
	<div class="help">
		Toque e deslize para se mover. <br>
		Você pode usar a tecla 'enter' para pausar o jogo (mas isso é trapaça!). <br>
		Você não precisa conhecer as <a href="https://pt.wikipedia.org/wiki/Xadrez#Movimenta%C3%A7%C3%A3o_das_pe%C3%A7as">regras do xadrez</a> para jogar, mas isso definitivamente ajudaria!
	</div>
	
	<!-- Mobile touch controls -->
	<div class="touch-controls">
		<div class="touch-button" id="up-btn">↑</div>
		<div class="touch-button" id="left-btn">←</div>
		<div class="touch-button" id="down-btn">↓</div>
		<div class="touch-button" id="right-btn">→</div>
	</div>
	
	<script>
		// Mobile touch and swipe controls
		let touchStartX = 0;
		let touchStartY = 0;
		let touchEndX = 0;
		let touchEndY = 0;
		const minSwipeDistance = 30; // Minimum distance for a swipe
		let isSwipeGesture = false;
		let touchStartTime = 0;
		
		// Wait for game to initialize
		window.addEventListener('load', function() {
			setupMobileControls();
		});
		
		function setupMobileControls() {
			// Touch button handlers
			const upBtn = document.getElementById('up-btn');
			const leftBtn = document.getElementById('left-btn');
			const downBtn = document.getElementById('down-btn');
			const rightBtn = document.getElementById('right-btn');
			
			if (upBtn) {
				upBtn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					e.stopPropagation();
					simulateKeyPress('up');
				});
			}
			
			if (leftBtn) {
				leftBtn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					e.stopPropagation();
					simulateKeyPress('left');
				});
			}
			
			if (downBtn) {
				downBtn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					e.stopPropagation();
					simulateKeyPress('down');
				});
			}
			
			if (rightBtn) {
				rightBtn.addEventListener('touchstart', function(e) {
					e.preventDefault();
					e.stopPropagation();
					simulateKeyPress('right');
				});
			}
			
			// Swipe detection on game area
			const gameArea = document.getElementById('root');
			if (gameArea) {
				gameArea.addEventListener('touchstart', function(e) {
					e.preventDefault();
					touchStartX = e.touches[0].clientX;
					touchStartY = e.touches[0].clientY;
					touchStartTime = Date.now();
					isSwipeGesture = false;
				}, { passive: false });
				
				gameArea.addEventListener('touchmove', function(e) {
					e.preventDefault();
					const deltaX = Math.abs(e.touches[0].clientX - touchStartX);
					const deltaY = Math.abs(e.touches[0].clientY - touchStartY);
					
					// If movement is significant, it's a swipe gesture
					if (deltaX > 10 || deltaY > 10) {
						isSwipeGesture = true;
					}
				}, { passive: false });
				
				gameArea.addEventListener('touchend', function(e) {
					e.preventDefault();
					touchEndX = e.changedTouches[0].clientX;
					touchEndY = e.changedTouches[0].clientY;
					
					const touchDuration = Date.now() - touchStartTime;
					
					if (isSwipeGesture) {
						handleSwipe();
					} else if (touchDuration < 200) {
						// Quick tap - simulate mouse click
						const rect = gameArea.getBoundingClientRect();
						const x = touchEndX - rect.left;
						const y = touchEndY - rect.top;
						simulateMouseClick(x, y);
					}
				}, { passive: false });
			}
		}
		
		function handleSwipe() {
			const deltaX = touchEndX - touchStartX;
			const deltaY = touchEndY - touchStartY;
			const absDeltaX = Math.abs(deltaX);
			const absDeltaY = Math.abs(deltaY);
			
			// Check if it's a valid swipe
			if (absDeltaX < minSwipeDistance && absDeltaY < minSwipeDistance) {
				return; // Not a swipe
			}
			
			// Determine direction
			if (absDeltaX > absDeltaY) {
				// Horizontal swipe
				if (deltaX > 0) {
					simulateKeyPress('right');
				} else {
					simulateKeyPress('left');
				}
			} else {
				// Vertical swipe
				if (deltaY > 0) {
					simulateKeyPress('down');
				} else {
					simulateKeyPress('up');
				}
			}
		}
		
		function simulateKeyPress(keyName) {
			// Simulate key press for the game
			if (typeof keys !== 'undefined' && keys[keyName] !== undefined) {
				keys[keyName] = 1;
				keyBoolMap[keyName] = true;
				
				// Reset after a short delay
				setTimeout(() => {
					keys[keyName] = 0;
					keyBoolMap[keyName] = false;
				}, 50);
			}
		}
		
		function simulateMouseClick(x, y) {
			// Simulate mouse click for board interaction
			if (typeof mouse !== 'undefined') {
				mouse.x = x;
				mouse.y = y;
				mouse.click = true;
			}
		}
		
		// Prevent default touch behaviors globally
		document.addEventListener('touchmove', function(e) {
			e.preventDefault();
		}, { passive: false });
		
		document.addEventListener('touchstart', function(e) {
			e.preventDefault();
		}, { passive: false });
		
		document.addEventListener('touchend', function(e) {
			e.preventDefault();
		}, { passive: false });
		
		// Prevent zoom and other mobile browser behaviors
		document.addEventListener('gesturestart', function(e) {
			e.preventDefault();
		});
		
		document.addEventListener('gesturechange', function(e) {
			e.preventDefault();
		});
		
		document.addEventListener('gestureend', function(e) {
			e.preventDefault();
		});
	</script>
</body>
</html>
